<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <link rel="icon" href="./assets/images/Graykids Academy Logo.png">
    <link rel="stylesheet" href="./styles/Normalize.css">
    <link rel="stylesheet" href="./styles/estilos.css">
    <script src="./scripts/header.js" defer></script>
    <script src="./scripts/animaciones.js" defer></script>
    <title>ConfirmaciÃ³n - Graykids Academy</title>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header__container container">
            <div class="header__logo">
                <a href="../index.html">
                    <img src="../assets/images/Graykids Academy Logo.png" alt="Graykids Academy Logo" class="header__logo-img">
                    <span class="header__logo-text">GRAYKIDS ACADEMY</span>
                </a>
            </div>
            <button class="header__toggle" type="button" aria-expanded="false" aria-controls="mainNavigation" aria-label="Abrir menÃº de navegaciÃ³n">
                <svg class="header__toggle-icon header__toggle-icon--menu" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M4 6h16v2H4zM4 11h16v2H4zM4 16h16v2H4z"></path>
                </svg>
                <svg class="header__toggle-icon header__toggle-icon--close" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: currentColor;">
                    <path d="m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"></path>
                </svg>
            </button>
            <div class="header__menu" id="mainNavigation">
                <button class="header__menu-close" type="button" aria-label="Cerrar menÃº">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"></path>
                    </svg>
                </button>
                <nav class="header__nav">
                    <a href="campus.html" class="header__link">
                        <span class="header__link-icon" aria-hidden="true">âœ¦</span>
                        <span class="header__link-label">Mi Campus</span>
                        <span class="header__link-trail" aria-hidden="true">â–¹</span>
                    </a>
                    <a href="cursos.html" class="header__link">
                        <span class="header__link-icon" aria-hidden="true">âœ¦</span>
                        <span class="header__link-label">Cursos VIP</span>
                        <span class="header__link-trail" aria-hidden="true">â–¹</span>
                    </a>
                    <a href="GraykidsMembers.html" class="header__link">
                        <span class="header__link-icon" aria-hidden="true">âœ¦</span>
                        <span class="header__link-label">Graykids Members</span>
                        <span class="header__link-trail" aria-hidden="true">â–¹</span>
                    </a>
                    <a href="Discord.html" class="header__link">
                        <span class="header__link-icon" aria-hidden="true">âœ¦</span>
                        <span class="header__link-label">Discord</span>
                        <span class="header__link-trail" aria-hidden="true">â–¹</span>
                    </a>
                    <a href="librerias.html" class="header__link">
                        <span class="header__link-icon" aria-hidden="true">âœ¦</span>
                        <span class="header__link-label">LibrerÃ­as</span>
                        <span class="header__link-trail" aria-hidden="true">â–¹</span>
                    </a>
                    <a href="contacto.html" class="header__link">
                        <span class="header__link-icon" aria-hidden="true">âœ¦</span>
                        <span class="header__link-label">Contacto</span>
                        <span class="header__link-trail" aria-hidden="true">â–¹</span>
                    </a>
                </nav>
                <span id="headerAuthButton" class="header__auth">
                    <a href="Login.html" class="btn btn--outline">Entrar</a>
                </span>
            </div>
        </div>
        <div class="header__overlay" hidden></div>
    </header>

    <!-- CONFIRMATION SECTION -->
    <section class="confirmation">
        <div class="confirmation__container container">
            <div class="confirmation__content">
                <div class="confirmation__icon">âœ…</div>
                <h1 class="confirmation__title">Â¡Pago Exitoso!</h1>
                <p class="confirmation__subtitle">Tu compra ha sido procesada correctamente</p>
                
                <div class="confirmation__details">
                    <div class="confirmation__item">
                        <span class="confirmation__label">Email:</span>
                        <span class="confirmation__value" id="userEmail">-</span>
                    </div>
                    <div class="confirmation__item">
                        <span class="confirmation__label">Producto:</span>
                        <span class="confirmation__value" id="productName">-</span>
                    </div>
                </div>

                <div class="confirmation__next-steps">
                    <h3 class="confirmation__next-steps-title">PrÃ³ximos Pasos:</h3>
                    <div class="steps-list">
                        <div class="step-item">
                            <div class="step-item__number">1</div>
                            <div class="step-item__content">
                                <h4 class="step-item__title">Revisa tu email</h4>
                                <p class="step-item__description">
                                    Hemos enviado un email a <strong id="emailConfirm">-</strong> con tu informaciÃ³n de acceso
                                </p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-item__number">2</div>
                            <div class="step-item__content">
                                <h4 class="step-item__title">Accede al contenido</h4>
                                <p class="step-item__description">
                                    Usa tus credenciales para ingresar al curso o iniciar tu membresÃ­a
                                </p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-item__number">3</div>
                            <div class="step-item__content">
                                <h4 class="step-item__title">Ãšnete a Discord</h4>
                                <p class="step-item__description">
                                    Conecta con otros miembros en nuestra comunidad exclusiva
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="confirmation__actions">
                    <a href="#" class="btn btn--primary btn--large" id="accessBtn">Acceder al Contenido</a>
                    <a href="../index.html" class="btn btn--outline btn--large">Volver al Inicio</a>
                </div>

                <div class="confirmation__help">
                    <p class="confirmation__help-text">
                        Â¿No recibiste el email? Revisa tu carpeta de spam o 
                        <a href="contacto.html" class="confirmation__help-link">contÃ¡ctanos</a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer id="contacto" class="footer">
        <div class="footer__container container">
            <div class="footer__logo">
                <img src="../assets/images/Graykids Academy Logo.png" alt="Graykids Academy Logo" class="footer__logo-img">
            </div>
            <div class="footer__links">
                <a href="contacto.html" class="footer__link">Contact</a>
                <a href="#" class="footer__link">TÃ©rminos y Condiciones</a>
                <a href="index.html#faq" class="footer__link">FAQ</a>
            </div>
            <p class="footer__copyright">Â© 2025 Graykids Academy</p>
        </div>
    </footer>

    <script>
        function normalizeEmail(email) {
            return typeof email === 'string' ? email.trim().toLowerCase() : '';
        }

        const COURSE_DEFAULT_MINUTES = {
            'curso-voces': 720,
            'curso-maquetizacion': 600,
            'curso-beats': 660,
            'curso-mezcla-beats': 540,
            'curso-sound-design': 600,
            'curso-vender-beats': 480,
            'curso-piano': 720
        };

        function persistCoursePurchase(paymentInfo) {
            if (!paymentInfo || paymentInfo.type !== 'course' || !paymentInfo.courseId) {
                return;
            }

            const paymentEmail = normalizeEmail(paymentInfo.userData?.email);
            let sessionEmail = '';

            try {
                const sessionUser = JSON.parse(localStorage.getItem('user') || '{}');
                sessionEmail = normalizeEmail(sessionUser.email);
            } catch (error) {
                console.error('Error reading current session for purchase persistence:', error);
            }

            const targetEmail = paymentEmail || sessionEmail;
            if (!targetEmail) {
                console.warn('No email available to registrar la compra del curso.');
                return;
            }

            try {
                const purchasedCourses = JSON.parse(localStorage.getItem('purchasedCourses') || '{}');
                const userCourses = Array.isArray(purchasedCourses[targetEmail]) ? purchasedCourses[targetEmail] : [];

                if (!userCourses.includes(paymentInfo.courseId)) {
                    userCourses.push(paymentInfo.courseId);
                    purchasedCourses[targetEmail] = userCourses;
                    localStorage.setItem('purchasedCourses', JSON.stringify(purchasedCourses));
                }
            } catch (error) {
                console.error('Error persisting purchased course:', error);
            }

            try {
                const progressStorage = JSON.parse(localStorage.getItem('courseProgressData') || '{}');
                const userProgress = progressStorage[targetEmail] || {};
                const defaultMinutes = COURSE_DEFAULT_MINUTES[paymentInfo.courseId] || 0;
                let mutated = false;

                if (!userProgress[paymentInfo.courseId]) {
                    userProgress[paymentInfo.courseId] = {
                        completedMinutes: 0,
                        totalMinutes: defaultMinutes,
                        lastUpdated: null
                    };
                    mutated = true;
                } else if (!userProgress[paymentInfo.courseId].totalMinutes && defaultMinutes) {
                    userProgress[paymentInfo.courseId].totalMinutes = defaultMinutes;
                    mutated = true;
                }

                if (mutated) {
                    progressStorage[targetEmail] = userProgress;
                    localStorage.setItem('courseProgressData', JSON.stringify(progressStorage));
                }
            } catch (error) {
                console.error('Error actualizando progreso del curso:', error);
            }
        }

        // Get data from localStorage
        const paymentDataRaw = localStorage.getItem('paymentData');
        const paymentData = paymentDataRaw ? JSON.parse(paymentDataRaw) : {};

        persistCoursePurchase(paymentData);
        
        // Update UI with user data
        if (paymentData.userData && paymentData.userData.email) {
            document.getElementById('userEmail').textContent = paymentData.userData.email;
            document.getElementById('emailConfirm').textContent = paymentData.userData.email;
        }
        
        // Update product name
        if (paymentData.type === 'course') {
            const courseMap = {
                'curso-beats': 'CÃ³mo Hacer Beats',
                'curso-mezcla-beats': 'CÃ³mo Mezclar Beats',
                'curso-voces': 'Mezcla y GrabaciÃ³n de Voces',
                'curso-sound-design': 'Sound Design Avanzado',
                'curso-vender-beats': 'CÃ³mo Vender Beats Online',
                'curso-piano': 'Piano de Cero a Experto'
            };
            document.getElementById('productName').textContent = courseMap[paymentData.courseId] || 'Curso';
            
            // If it's the voces course, redirect to course player
            if (paymentData.courseId === 'curso-voces') {
                // Save current course to localStorage
                localStorage.setItem('currentCourse', paymentData.courseId);
                
                // Update button to go to course player
                document.getElementById('accessBtn').href = 'curso-player.html';
                document.getElementById('accessBtn').textContent = 'Ir al Curso';
                
                // Optional: Auto-redirect after 3 seconds
                setTimeout(() => {
                    window.location.href = 'curso-player.html';
                }, 3000);
            } else {
                document.getElementById('accessBtn').href = `cursos.html#${paymentData.courseId}`;
            }
        } else if (paymentData.plan) {
            const planMap = {
                'monthly': 'Plan Mensual',
                'yearly': 'Plan Anual',
                'lifetime': 'Plan Vitalicio'
            };
            document.getElementById('productName').textContent = planMap[paymentData.plan] || 'Graykids Members';
            document.getElementById('accessBtn').href = 'GraykidsMembers.html?payment=success';
        }

        // Simulate sending confirmation email
        console.log('Sending confirmation email to:', paymentData.userData?.email);

        if (paymentDataRaw) {
            localStorage.removeItem('paymentData');
        }
        
        // In production, you would make an API call here to send the email
        // Example: 
        // fetch('/api/send-confirmation-email', {
        //     method: 'POST',
        //     body: JSON.stringify(paymentData)
        // });
    </script>
</body>
</html>










