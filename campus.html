<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Images/Graykids Academy Logo.png">
    <link rel="stylesheet" href="CSS/Normalize.css">
    <link rel="stylesheet" href="CSS/estilos.css">
    <script src="js/animaciones.js" defer></script>
    <title>Mi Campus - Graykids Academy</title>
    <style>
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loading-logo {
            width: 180px;
            height: 180px;
            object-fit: contain;
            animation: logoPulse 2s ease-in-out infinite;
            margin-bottom: 30px;
            filter: drop-shadow(0 0 20px rgba(57, 243, 212, 0.5));
        }
        @keyframes logoPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.9; }
        }
        .loading-spinner-ring {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(57, 243, 212, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 25px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            color: var(--primary-color);
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 3px;
            animation: textFade 2s ease-in-out infinite;
        }
        @keyframes textFade {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="campus-body">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <img src="Images/Graykids Academy Logo.png" alt="Graykids Academy" class="loading-logo">
        <div class="loading-spinner-ring"></div>
        <p class="loading-text">CARGANDO</p>
    </div>
    <!-- HEADER -->
    <header class="header header--campus">
        <div class="header__container container">
            <div class="header__logo">
                <a href="index.html" style="display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit;">
                    <img src="Images/Graykids Academy Logo.png" alt="Graykids Academy Logo" class="header__logo-img">
                    <span class="header__logo-text">Graykids Academy</span>
                </a>
            </div>
            <nav class="header__nav">
                <a href="#mis-cursos" class="header__link nav-link active" data-section="campus">Mis Cursos</a>
                <a href="cursos.html" class="header__link nav-link" data-page="cursos.html">Cursos VIP</a>
                <a href="GraykidsPlus.html" class="header__link nav-link" data-page="GraykidsPlus.html">Graykids Plus</a>
                <a href="Discord.html" class="header__link nav-link" data-page="Discord.html">Discord</a>
                <a href="librerias.html" class="header__link nav-link" data-page="librerias.html">Librerías</a>
                <a href="contacto.html" class="header__link nav-link" data-page="contacto.html">Contacto</a>
            </nav>
            <div class="header__user">
                <button class="btn btn--outline" onclick="logout()">Cerrar Sesión</button>
            </div>
        </div>
    </header>

    <!-- CONTENEDOR DINÁMICO -->
    <div id="campusContentWrapper" class="campus-content-wrapper"></div>

    <!-- CAMPUS HERO -->
    <section class="campus-hero" id="campus-sections">
        <div class="campus-hero__container container">
            <div class="campus-welcome">
                <h1 class="campus-welcome__title">¡Bienvenido, <span id="userName">Usuario</span>! 👋</h1>
                <p class="campus-welcome__subtitle">Sigue aprendiendo y creciendo como productor</p>
            </div>
            <div class="campus-stats" id="campusStats">
                <div class="campus-stat">
                    <div class="campus-stat__number" id="coursesCount">0</div>
                    <div class="campus-stat__label">Cursos Activos</div>
                </div>
                <div class="campus-stat">
                    <div class="campus-stat__number" id="totalProgressPercent">0%</div>
                    <div class="campus-stat__label">Progreso General</div>
                </div>
                <div class="campus-stat">
                    <div class="campus-stat__number" id="totalContentHours">0h</div>
                    <div class="campus-stat__label">Horas de Contenido</div>
                </div>
            </div>
        </div>
    </section>

    <!-- MI CURSOS -->
    <section id="mis-cursos" class="my-courses">
        <div class="my-courses__container container">
            <h2 class="my-courses__title">Mis Cursos</h2>
            <p class="my-courses__subtitle">Continúa donde lo dejaste</p>

            <div class="my-courses__grid" id="coursesGrid">
                <!-- Courses will be dynamically added here -->
                <div class="empty-state">
                    <div class="empty-state__icon">📚</div>
                    <h3 class="empty-state__title">Aún no tienes cursos</h3>
                    <p class="empty-state__description">
                        Explora nuestros cursos y comienza tu viaje en la producción musical
                    </p>
                <a href="cursos.html?available=true" class="btn btn--primary">Ver Cursos</a>
                </div>
            </div>
        </div>
    </section>

    <!-- PROGRESO -->
    <section class="campus-progress">
        <div class="campus-progress__container container">
            <h3 class="campus-progress__title">Tu Progreso</h3>
            <div class="progress-list" id="progressList">
                <!-- Progress items will be added dynamically -->
            </div>
        </div>
    </section>

    <!-- CURSOS DISPONIBLES -->
    <section class="campus-available-courses">
        <div class="campus-available-courses__container container">
            <div class="campus-available-courses__header">
                <h3 class="campus-available-courses__title">Explora Más Cursos VIP</h3>
                <p class="campus-available-courses__subtitle">Continúa ampliando tus conocimientos</p>
            </div>

            <div class="campus-available-courses__grid" id="campusCoursesContainer">
                <!-- Los cursos se cargarán dinámicamente aquí -->
            </div>
            
            <script src="js/courses-loader.js"></script>
            <script>
                // Loading Screen
                window.addEventListener('load', function() {
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) {
                        setTimeout(() => {
                            loadingScreen.classList.add('hidden');
                            setTimeout(() => {
                                loadingScreen.style.display = 'none';
                            }, 200);
                        }, 300);
                    }
                });
                // Cargar cursos en el campus dinámicamente
                function loadCampusCourses() {
                    const container = document.getElementById('campusCoursesContainer');
                    if (!container) return;
                    
                    container.innerHTML = '';
                    
                    const coursesInfo = getCoursesInfo();
                    const defaultCourseIds = ['curso-voces', 'curso-maquetizacion', 'curso-beats'];
                    
                    defaultCourseIds.forEach(courseId => {
                        const course = getCourseInfo(courseId);
                        if (!course) return;
                        
                        const isAvailable = course.status === 'available' || course.status === undefined;
                        
                        const cardHTML = `
                            <div class="available-course-card">
                                <div class="available-course-card__icon">${course.icon || '🎓'}</div>
                                <h4 class="available-course-card__title">${course.name}</h4>
                                ${isAvailable 
                                    ? `<p class="available-course-card__price">$${course.price || '0.00'}</p>
                                       <div class="available-course-card__actions">
                                           <a href="checkout.html?type=course&id=${courseId}" class="btn btn--secondary">Comprar Curso</a>
                                           <a href="curso-preview.html?course=${courseId}" class="btn btn--outline">Ver Presentación</a>
                                       </div>`
                                    : `<p class="available-course-card__price" style="opacity: 0.6;">Próximamente</p>
                                       <div class="available-course-card__actions">
                                           <span class="btn btn--secondary" style="opacity: 0.6; cursor: not-allowed; pointer-events: none;">Próximamente</span>
                                           <a href="curso-preview.html?course=${courseId}" class="btn btn--outline">Ver Presentación</a>
                                       </div>`
                                }
                            </div>
                        `;
                        container.innerHTML += cardHTML;
                    });
                }
                
                document.addEventListener('DOMContentLoaded', loadCampusCourses);
            </script>

            <div class="campus-available-courses__view-all">
                <a href="cursos.html?available=true" class="btn btn--primary btn--large">Ver Todos los Cursos</a>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer__container container">
            <div class="footer__logo">
                <img src="Images/Graykids Academy Logo.png" alt="Graykids Academy Logo" class="footer__logo-img">
            </div>
            <div class="footer__links">
                <a href="contacto.html" class="footer__link">Contact</a>
                <a href="#" class="footer__link">Términos y Condiciones</a>
                <a href="index.html#faq" class="footer__link">FAQ</a>
            </div>
            <p class="footer__copyright">© 2025 Graykids Academy</p>
        </div>
    </footer>

    <script>
        // Check if user is logged in
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const user = localStorage.getItem('user');
            
            if (!isLoggedIn || !user) {
                alert('Debes iniciar sesión para acceder al campus');
                window.location.href = 'Login.html';
                return;
            }
            
            return JSON.parse(user);
        }

        function normalizeEmail(email) {
            return typeof email === 'string' ? email.trim().toLowerCase() : '';
        }

        // Display user info
        function displayUserInfo() {
            const user = checkAuth();
            if (user) {
                document.getElementById('userName').textContent = user.name || 'Usuario';
            }
        }

        // Get purchased courses from localStorage
        function getPurchasedCourses() {
            const userString = localStorage.getItem('user');
            if (!userString) return [];

            try {
                const user = JSON.parse(userString);
                const userEmail = normalizeEmail(user.email);
                if (!userEmail) return [];

                const purchasedCoursesMap = JSON.parse(localStorage.getItem('purchasedCourses') || '{}');
                const purchasedCourses = purchasedCoursesMap[userEmail] || [];

                if (Array.isArray(purchasedCourses) && purchasedCourses.length > 0) {
                    return purchasedCourses;
                }

                // Fallback legacy data: compatibilidad con versiones anteriores solo si pertenece al usuario actual
                const paymentDataRaw = localStorage.getItem('paymentData');
                if (paymentDataRaw) {
                    try {
                        const paymentData = JSON.parse(paymentDataRaw);
                        if (paymentData.type === 'course' && paymentData.courseId) {
                            const paymentEmail = normalizeEmail(paymentData.userData?.email || user.email);
                            if (paymentEmail === userEmail) {
                                const legacyCourses = purchasedCoursesMap[userEmail] || [];
                                if (!legacyCourses.includes(paymentData.courseId)) {
                                    legacyCourses.push(paymentData.courseId);
                                    purchasedCoursesMap[userEmail] = legacyCourses;
                                    localStorage.setItem('purchasedCourses', JSON.stringify(purchasedCoursesMap));
                                }
                                return legacyCourses;
                            }
                        }
                    } catch (error) {
                        console.error('Error parsing legacy payment data:', error);
                    }
                }
            } catch (e) {
                console.error('Error retrieving purchased courses:', e);
            }

            return [];
        }

        // Courses database
        const coursesDatabase = {
            'curso-voces': {
                name: 'Mezcla y Grabación de Voces',
                description: 'Nivel Avanzado. Aprende técnicas profesionales para grabar y mezclar voces como los grandes productores.',
                icon: '🎤',
                price: 99.99,
                lessons: 60,
                totalHours: 12,
                totalMinutes: 720,
                level: 'Avanzado'
            },
            'curso-maquetizacion': {
                name: 'Maquetización Composicional',
                description: 'Nivel Intermedio. Domina el arte de estructurar y organizar tus composiciones musicales.',
                icon: '🎹',
                price: 89.99,
                lessons: 50,
                totalHours: 10,
                totalMinutes: 600,
                level: 'Intermedio'
            },
            'curso-beats': {
                name: 'Programación de Beats',
                description: 'Nivel Intermedio. Aprende a programar beats profesionales desde cero.',
                icon: '🎛️',
                price: 79.99,
                lessons: 55,
                totalHours: 11,
                totalMinutes: 660,
                level: 'Intermedio'
            }
        };

        const COURSE_PROGRESS_STORAGE_KEY = 'courseProgressData';
        let initialCoursesGridHTML = null;
        let initialProgressListHTML = null;

        function extractHoursFromText(hoursText) {
            if (!hoursText) return null;
            const match = hoursText.toString().match(/\d+(?:[.,]\d+)?/);
            if (!match) return null;
            const value = parseFloat(match[0].replace(',', '.'));
            return Number.isNaN(value) ? null : value;
        }

        function formatHoursShort(minutes) {
            if (!minutes || minutes <= 0) {
                return '0h';
            }
            const hours = minutes / 60;
            if (hours >= 10) {
                return `${Math.round(hours)}h`;
            }
            if (hours >= 1) {
                return `${hours.toFixed(1)}h`;
            }
            return `${Math.round(minutes)}m`;
        }

        function getCourseMeta(courseId) {
            const base = { ...(coursesDatabase[courseId] || {}) };

            if (typeof getCourseInfo === 'function') {
                try {
                    const dynamicInfo = getCourseInfo(courseId);
                    if (dynamicInfo) {
                        base.name = dynamicInfo.name || base.name;
                        base.icon = dynamicInfo.icon || base.icon;
                        if (dynamicInfo.description) base.description = dynamicInfo.description;

                        const parsedHours = extractHoursFromText(dynamicInfo.hours);
                        if (parsedHours) {
                            base.totalHours = parsedHours;
                            base.totalMinutes = Math.round(parsedHours * 60);
                        }

                        if (dynamicInfo.videos) {
                            const videosMatch = dynamicInfo.videos.toString().match(/\d+/);
                            if (videosMatch) {
                                base.lessons = parseInt(videosMatch[0], 10);
                            }
                        }
                    }
                } catch (error) {
                    console.warn('No se pudo obtener información dinámica del curso', courseId, error);
                }
            }

            if (!base.totalMinutes && base.totalHours) {
                base.totalMinutes = Math.round(base.totalHours * 60);
            }

            if (!base.totalHours && base.totalMinutes) {
                base.totalHours = base.totalMinutes / 60;
            }

            return base;
        }

        function getUserCoursesData() {
            const userString = localStorage.getItem('user');
            let user = {};

            try {
                user = userString ? JSON.parse(userString) : {};
            } catch (error) {
                console.error('Error al leer el usuario actual', error);
            }

            const email = normalizeEmail(user?.email);
            const purchasedCourses = getPurchasedCourses();

            let progressStorage = {};
            try {
                progressStorage = JSON.parse(localStorage.getItem(COURSE_PROGRESS_STORAGE_KEY) || '{}');
            } catch (error) {
                console.error('Error al leer el progreso de cursos', error);
            }

            const userProgressMap = email ? { ...(progressStorage[email] || {}) } : {};
            let storageMutated = false;

            const entries = purchasedCourses
                .map(courseId => {
                    const meta = getCourseMeta(courseId);
                    if (!meta || !meta.name) return null;

                    let progressEntry = userProgressMap[courseId];
                    const totalMinutesFromMeta = meta.totalMinutes || 0;

                    if (!progressEntry) {
                        progressEntry = {
                            completedMinutes: 0,
                            totalMinutes: totalMinutesFromMeta,
                            lastUpdated: null
                        };
                        userProgressMap[courseId] = progressEntry;
                        storageMutated = true;
                    } else {
                        if (totalMinutesFromMeta && (!progressEntry.totalMinutes || progressEntry.totalMinutes < totalMinutesFromMeta)) {
                            progressEntry.totalMinutes = totalMinutesFromMeta;
                            storageMutated = true;
                        }

                        if (progressEntry.totalMinutes && progressEntry.completedMinutes > progressEntry.totalMinutes) {
                            progressEntry.completedMinutes = progressEntry.totalMinutes;
                            storageMutated = true;
                        }
                    }

                    const totalMinutes = progressEntry.totalMinutes || totalMinutesFromMeta || 0;
                    const completedMinutes = Math.min(progressEntry.completedMinutes || 0, totalMinutes || progressEntry.completedMinutes || 0);
                    const percent = totalMinutes > 0 ? Math.round((completedMinutes / totalMinutes) * 100) : 0;
                    const remainingMinutes = totalMinutes > 0 ? Math.max(totalMinutes - completedMinutes, 0) : 0;

                    return {
                        courseId,
                        meta,
                        progressEntry,
                        computed: {
                            totalMinutes,
                            completedMinutes,
                            remainingMinutes,
                            percent
                        }
                    };
                })
                .filter(Boolean);

            const totalMinutes = entries.reduce((acc, entry) => acc + entry.computed.totalMinutes, 0);
            const completedMinutes = entries.reduce((acc, entry) => acc + entry.computed.completedMinutes, 0);
            const overallPercent = totalMinutes > 0 ? Math.round((completedMinutes / totalMinutes) * 100) : 0;

            if (storageMutated && email) {
                progressStorage[email] = userProgressMap;
                localStorage.setItem(COURSE_PROGRESS_STORAGE_KEY, JSON.stringify(progressStorage));
            }

            return {
                email,
                purchasedCourses,
                entries,
                stats: {
                    totalCourses: purchasedCourses.length,
                    totalMinutes,
                    completedMinutes,
                    percent: overallPercent
                }
            };
        }

        function renderCourses(context) {
            const grid = document.getElementById('coursesGrid');
            if (!grid) return;

            if (initialCoursesGridHTML === null) {
                initialCoursesGridHTML = grid.innerHTML;
            }

            if (!context || context.entries.length === 0) {
                if (initialCoursesGridHTML !== null) {
                    grid.innerHTML = initialCoursesGridHTML;
                }
                return;
            }

            grid.innerHTML = '';

            context.entries.forEach(({ courseId, meta, computed }) => {
                const card = document.createElement('article');
                card.className = 'course-progress-card';

                const totalLabel = formatHoursShort(computed.totalMinutes);
                const completedLabel = formatHoursShort(computed.completedMinutes);
                const remainingLabel = formatHoursShort(computed.remainingMinutes);
                const statusText = computed.completedMinutes > 0
                    ? `Has estudiado ${completedLabel} de ${totalLabel}`
                    : 'Listo para comenzar';

                card.innerHTML = `
                    <div class="course-progress-card__header">
                        <div class="course-progress-card__icon">${meta.icon || '🎓'}</div>
                        <div>
                            <h4 class="course-progress-card__title">${meta.name || 'Curso'}</h4>
                            <p class="course-progress-card__meta">${meta.lessons || 0} lecciones • ${totalLabel} totales</p>
                        </div>
                    </div>
                    <div class="course-progress-card__stats">
                        <div class="course-progress-card__stat">
                            <span class="course-progress-card__stat-label">Avance</span>
                            <span class="course-progress-card__stat-value">${computed.percent}%</span>
                        </div>
                        <div class="course-progress-card__stat">
                            <span class="course-progress-card__stat-label">Estudiado</span>
                            <span class="course-progress-card__stat-value">${completedLabel}</span>
                        </div>
                        <div class="course-progress-card__stat">
                            <span class="course-progress-card__stat-label">Restante</span>
                            <span class="course-progress-card__stat-value">${remainingLabel}</span>
                        </div>
                    </div>
                    <div class="course-progress-card__bar">
                        <div class="course-progress-card__fill" style="width: ${computed.percent}%"></div>
                    </div>
                    <div class="course-progress-card__footer">
                        <span class="course-progress-card__status">${statusText}</span>
                        <button class="btn btn--primary" onclick="openCourse('${courseId}')">Continuar Curso</button>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        // Open course
        function openCourse(courseId) {
            // Save current course to localStorage
            localStorage.setItem('currentCourse', courseId);
            
            // Redirect to course player
            window.location.href = 'curso-player.html';
        }

        function renderProgress(context) {
            const progressList = document.getElementById('progressList');
            if (!progressList) return;

            if (initialProgressListHTML === null) {
                initialProgressListHTML = progressList.innerHTML;
            }

            if (!context || context.entries.length === 0) {
                progressList.innerHTML = '<p>No hay progreso aún. Compra un curso para comenzar!</p>';
                return;
            }

            progressList.innerHTML = '';

            context.entries.forEach(({ meta, computed }) => {
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item';
                progressItem.innerHTML = `
                    <div class="progress-item__info">
                        <h4 class="progress-item__title">${meta.name || 'Curso'}</h4>
                        <span class="progress-item__lessons">${formatHoursShort(computed.completedMinutes)} de ${formatHoursShort(computed.totalMinutes)} • ${computed.percent}%</span>
                    </div>
                    <div class="progress-item__bar">
                        <div class="progress-item__fill" style="width: ${computed.percent}%"></div>
                    </div>
                `;
                progressList.appendChild(progressItem);
            });
        }

        function updateCampusStats(context) {
            const stats = context?.stats || { totalCourses: 0, percent: 0, totalMinutes: 0 };

            const coursesCountEl = document.getElementById('coursesCount');
            if (coursesCountEl) {
                coursesCountEl.textContent = stats.totalCourses;
            }

            const totalProgressEl = document.getElementById('totalProgressPercent');
            if (totalProgressEl) {
                totalProgressEl.textContent = `${stats.percent}%`;
            }

            const totalContentEl = document.getElementById('totalContentHours');
            if (totalContentEl) {
                totalContentEl.textContent = formatHoursShort(stats.totalMinutes);
            }
        }

        function refreshUserCourseViews() {
            const context = getUserCoursesData();
            updateCampusStats(context);
            renderCourses(context);
            renderProgress(context);
        }

        // Cookie functions
        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
        }

        // Logout function
        function logout() {
            if (confirm('¿Estás seguro que quieres cerrar sesión?')) {
                // Limpiar localStorage
                localStorage.removeItem('user');
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('access_token');
                localStorage.removeItem('currentCourse');
                
                // Limpiar cookies
                deleteCookie('user_session');
                deleteCookie('is_logged_in');
                
                // Limpiar sessionStorage
                sessionStorage.removeItem('oauth_redirect_from');
                sessionStorage.removeItem('google_user_email');
                
                window.location.href = 'Login.html';
            }
        }
        
        // Hacer logout disponible globalmente
        window.logout = logout;

        // Initialize campus
        displayUserInfo();
        refreshUserCourseViews();

        // Check for success message
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('login') === 'success') {
            setTimeout(() => {
                alert('¡Bienvenido al campus! 🎉');
            }, 500);
        }

        // Navegación dinámica dentro del campus
        function loadPageInCampus(pageUrl) {
            const contentWrapper = document.getElementById('campusContentWrapper');
            const campusSections = document.getElementById('campus-sections');
            
            // Ocultar secciones del campus
            campusSections.style.display = 'none';
            
            // Mostrar contenedor dinámico
            contentWrapper.style.display = 'block';
            
            // Agregar parámetro para indicar que está en iframe
            const separator = pageUrl.includes('?') ? '&' : '?';
            const iframeUrl = `${pageUrl}${separator}iframe=true`;
            
            // Cargar página en iframe
            contentWrapper.innerHTML = `
                <div class="campus-iframe-container">
                    <div class="campus-iframe-header">
                        <button class="campus-close-btn" onclick="closeExternalPage()">
                            <span>← Volver al Campus</span>
                        </button>
                    </div>
                    <iframe src="${iframeUrl}" class="campus-iframe"></iframe>
                </div>
            `;
        }

        function closeExternalPage() {
            const contentWrapper = document.getElementById('campusContentWrapper');
            const campusSections = document.getElementById('campus-sections');
            
            // Mostrar secciones del campus
            campusSections.style.display = 'block';
            
            // Ocultar contenedor dinámico
            contentWrapper.style.display = 'none';
            
            // Remover iframe
            contentWrapper.innerHTML = '';
            
            // Quitar active de todos los enlaces
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Marcar "Mis Cursos" como activo
            document.querySelector('[data-section="campus"]').classList.add('active');
        }

        // Agregar event listeners a los enlaces
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover active de todos
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                // Agregar active al clickeado
                this.classList.add('active');
                
                // Si tiene data-page, cargar en iframe
                if (this.dataset.page) {
                    loadPageInCampus(this.dataset.page);
                } else if (this.dataset.section === 'campus') {
                    closeExternalPage();
                    // Scroll a la sección
                    const section = document.querySelector('#mis-cursos');
                    if (section) {
                        section.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });

        window.closeExternalPage = closeExternalPage;
    </script>
</body>
</html>

